<?phpclass Quotation_model extends CI_Model{    function __construct()    {        $this->load->database();    }            public function get_customers()    {        $this->db->select('*');        $this->db->where('status',1);        $query=$this->db->get('tbl_registration');        return $query->result();    }        public function get_customers_company()    {    $this->db->distinct();    $this->db->select('company_name');    $query = $this->db->get('tbl_customer');    return $query->result_array();}        public function get_customers_byid($id)    {        $this->db->select('*');        $this->db->where('customer_id',$id);        $query=$this->db->get('tbl_registration');        return $query->row();    }    public function get_image_byid($id)    { $this->db->select('*');        $this->db->where('images_filename',$id);        $query=$this->db->get('tbl_images_search');        return $query->row();    }    public function get_surface_byid($id)    {        $this->db->select('*');        $this->db->where('surface_id',$id);        $query=$this->db->get('tbl_surface');        return $query->row();    }    public function get_surfaces()    {   $this->db->select('*');        $query=$this->db->get('tbl_surface');        return $query->result();    }    public function get_frames()    {        $this->db->select('*');        $query=$this->db->get('tbl_frame');        return $query->result();    }    public function get_frame_byid($id)    {        $this->db->select('*');        $this->db->where('frame_id',$id);        $query=$this->db->get('tbl_frame');        return $query->row();    }    public function get_mounts()    {        $this->db->select('*');        $query=$this->db->get('tbl_mount');        return $query->result();    }    public function get_mount_byid($id)    {        $this->db->select('*');        $this->db->where('mount_id',$id);        $query=$this->db->get('tbl_mount');        return $query->row();    }    public function get_glasses()    {        $this->db->select('*');        $query=$this->db->get('tbl_glass');        return $query->result();    }    public function get_glass_byid($id)    {        $this->db->select('*');        $this->db->where('id',$id);        $query=$this->db->get('tbl_glass');        return $query->row();    }        public function get_all_quotation_details($quotation_id)    {   $this->db->select('*');        $this->db->order_by('id','desc');        $this->db->where('quotation_id',$quotation_id);        $query=$this->db->get('tbl_quotation');        return $query->result();    }                public function get_view_quotation_details($quotation_id){        $sql="select * from tbl_quotation q inner join tbl_quotation_details q_d on q.quotation_id=q_d.quotation_id";        $rows=  mysql_query($sql);        return mysql_fetch_assoc($rows);  }    public function convert_into_invoice($quotation_id)    {        $sql="INSERT INTO tbl_invoice (invoice_id, customer_id, image_id, licence_cost, surface, print_size_height, print_size_width, print_cost, print_total, frame_id, frame_code, frame_size_height, frame_size_width, frame_cost, frame_total, mount_id, mount_code, mount_size_height, mount_size_width, mount_cost, mount_total, glass_id, glass_cost, status, total, after_discount, discount, tax, packing_charge, courier_charge, sales_person, sales_emailid, sales_contact, client_servicing, client_emailid, client_contact, createdby,convert_to_order)SELECT quotation_id, customer_id, image_id, licence_cost, surface, print_size_height, print_size_width, print_cost, print_total, frame_id, frame_code, frame_size_height, frame_size_width, frame_cost, frame_total, mount_id, mount_code, mount_size_height, mount_size_width, mount_cost, mount_total, glass_id, glass_cost, status, total, after_discount, discount, tax, packing_charge, courier_charge, sales_person, sales_emailid, sales_contact, client_servicing, client_emailid, client_contact, createdby,'0'FROM tbl_quotation where quotation_id='".$quotation_id."'";       $insert=  mysql_query($sql);                     $sql2="INSERT INTO tbl_invoice_details (customer_id, invoice_id, first_name, last_name, email_id, gander, marries_statue, address, company_name, country, state, city, region, pincode, contact, created_date)SELECT customer_id, quotation_id, first_name, last_name, email_id, gander, marries_statue, address, company_name, country, state, city, region, pincode, contact, created_dateFROM tbl_quotation_details where quotation_id='".$quotation_id."'";       $insert2=  mysql_query($sql2);                          if($insert && $insert2)       {           $sql_2="update tbl_quotation set convert_to_invoice='1' where quotation_id='".$quotation_id."'";           mysql_query($sql_2);           return 1;       }else{           return 0;       }    }        public function insert_quotation($data)    {        $this->db->insert('tbl_quotation',$data);        return $this->db->insert_id();    }    public function insert_quotation_detail($data2)    {        $this->db->insert('tbl_quotation',$data2);        return $this->db->insert_id();    }    public function update_quotation_code($insert_id,$detail_id)    {        $data=array('quotation_id'=>$insert_id);        $this->db->where('id',$detail_id);        $this->db->update('tbl_quotation',$data);    }    public function update_quotation_total($quotation_id,$data3)    {   $data=array('total_amount'=>$data3);        $this->db->where('id',$quotation_id);        $this->db->set($data);        $value=$this->db->update('tbl_quotation');        // $query=$this->db->get('tbl_quotation');        //$data1=$query->row_array();        //$value=$data1['total_amount'];        //   return $value;    }    public function update_quotation_detail($data2,$id)    {        $this->db->where('id',$id);        $this->db->update('tbl_quotation_detail',$data2);    }    public function get_quotation_byid($id)    {    $this->db->select('*');        $this->db->from('tbl_quotation');        // $this->db->from('tbl_quotation_detail');        //$this->db->select('*');        $join = 'inner';        $this->db->join('tbl_quotation_detail', 'tbl_quotation_detail.quotation_id = tbl_quotation.id', $join);        $this->db->where('tbl_quotation.id',$id);        $query=$this->db->get();        return $query->result();    }    public function get_quotation_det($id)    {        $this->db->select('*');        $this->db->where('id',$id);        $query=$this->db->get('tbl_quotation');        return $query->result() ;    }    public function get_quotation_image($id)    {        $this->db->select('*');        $this->db->where('quotation_id',$id);        $query=$this->db->get('tbl_quotation');        return $query->result();    }    public function edit_quotation_image($id)    {        $this->db->select('*');        $this->db->where('id',$id);        $query=$this->db->get('tbl_quotation');        return $query->result();    }    public  function delete_surface_byid($id)    {  //$this->db->select('*');        $this->db->where('surface_detail_id',$id);        $query=$this->db->delete('tbl_surface_detail');        return $query->row();    }    public function get_image_detail($id)    {        $this->db->select('*');        $this->db->where('images_filename',$id);        $query=$this->db->get('tbl_images_search');        return $query->result() ;    }    public function get_cust_detail($id)    {        $this->db->select('*');        $this->db->where('customer_id',$id);        $query=$this->db->get('tbl_registration');        return $query->result() ;    }    public function get_total($id)    {        $this->db->select('*');        $this->db->where('id',$id);        $query=$this->db->get('tbl_quotation');        return $query->result() ;    }    public function get_total_images($id)    {        $this->db->select('*');        $this->db->where('quotation_id',$id);        $query=$this->db->get('tbl_quotation');        return $query->result_array();        //return mysql_num_rows($query);    }    public function update_quotation_final($id,$data3)    {        $this->db->where('id',$id);        //  $this->db->set($data);        $value=$this->db->update('tbl_quotation',$data3);        return $value;    }    public function get_quotation($id)    {        $this->db->select('*');        $this->db->where('id',$id);        $query = $this->db->get('tbl_quotation');        return $query->result_array();    }    public function get_quotation_detail($id)    {        $this->db->select('*');        $this->db->where('quotation_id',$id);        $query = $this->db->get('tbl_quotation');        return $query->result_array();    }    public function search_quotation($contact_person,$quotation_id,$quotation_status,$sales_person)    {        $this->db->select('*');        if($quotation_id)        {            $this->db->where('id',$quotation_id);        }                if($contact_person)        {            $this->db->where('client_name',$contact_person);        }        if($sales_person)        {            $this->db->where('sales_person',$sales_person);        }                $query=$this->db->get('tbl_quotation_details');        return $query->result_array();    }    public function search_invoice($contact_person,$quotation_id,$quotation_status,$sales_person)    {        $this->db->select('*');        if($quotation_id)        {            $this->db->where('id',$quotation_id);        }        if($quotation_status=='1')        {            $this->db->where('convert_to_invoice',$quotation_status);        }        if($contact_person)        {            $this->db->where('client_name',$contact_person);        }        if($sales_person)        {            $this->db->where('sales_person',$sales_person);        }               $query=$this->db->get('tbl_quotation');        return $query->result_array();    }    public function record_count_quotation()    {       $this->db->select('*');       $query=$this->db->get('tbl_quotation');        return $query->num_rows();    }    public function get_quotation_pagination($limit,$start)    {       $sql="select * from tbl_quotation q inner join tbl_quotation_details q_d on q.quotation_id=q_d.quotation_id";      return  $rows=  mysql_query($sql);    }    public function get_quotation_details($id)    {        $this->db->select('*');        $this->db->where('id',$id);        $query=$this->db->get('tbl_quotation');        return $query->row();    }    public function delete_quotation($quotation_id)    {       $sql="update tbl_quotation set convert_to_invoice='2' where quotation_id='".$quotation_id."'";        $update=  mysql_query($sql);          if($update)       {           return 1;       }else{           return 0;       }    }    public function delete_quotation_detail($id)    {        $data=array('status'=>'2');        $this->db->where('quotation_id',$id);        $this->db->update('tbl_quotation',$data);    }    public function convert_quotation($id)    {        $data=array('convert_to_invoice'=>'1');        $this->db->where('id',$id);        $this->db->update('tbl_quotation',$data);    }    public function get_customer_detail($id)    {        $this->db->select('*');        $this->db->where('customer_id',$id);        $query = $this->db->get('tbl_registration');        return $query->result();    }    public function get_packagers()    {        $this->db->select('*');        $this->db->where('vender_type',3);        $query = $this->db->get('tbl_vender');        return $query->result();    }    public  function get_pack_byid($id)    {        $this->db->select('*');        $this->db->where('vender_id',$id);        $query = $this->db->get('tbl_vender');        return $query->row();    }    public function get_courier()    {        $this->db->select('*');        $this->db->where('vender_type',4);        $query = $this->db->get('tbl_vender');        return $query->result();    }    public function get_cor_byid($id)    {        $this->db->select('*');        $this->db->where('vender_id',$id);        $query = $this->db->get('tbl_vender');        return $query->row();    }    public function get_customer_byname($q)    {        $this->db->select('*');        $this->db->like('first_name', $q);        $query = $this->db->get('tbl_registration');        if($query->num_rows > 0)        {            foreach ($query->result_array() as $row)            {                //build an array for the towns                $row_set[] =htmlentities(stripslashes($row['first_name']." ".$row['last_name']." ".($row['customer_id'])));                //  $row_set[]=htmlentities(stripslashes($row['customer_id']));                // $row_set[] = htmlentities(stripslashes(($row['address'])));            }            //format the array into json data            // header('Content-Type: application/x-json; charset=utf-8');            // echo json_encode($row_set);            // $this->output            //     ->set_content_type('application/json')            //   ->set_output(json_encode($row_set));            echo json_encode($row_set);            // print json_encode($row_set['lastname']);            //  echo json_encode($query->row());        }        // return $query->row();    }    public function get_customers_byname($firstname,$lastname)    {        $this->db->select('*');        $this->db->where('first_name',$firstname);        $this->db->where('last_name',$lastname);        $query=$this->db->get('tbl_registration');        return $query->row();    }    public function update_quotation($data,$id)    {        $this->db->where('id',$id);        $this->db->update('tbl_quotation',$data);    }}